{% extends 'base.html' %} {% load static %} 
{% block title %}TravelWise - Create Plan{% endblock %} 

{% load crispy_forms_tags %} {% block css %}
<link rel="stylesheet" href="{% static 'css/travel-header.css' %}" />
{% endblock %} {% block content %}

<section>
  <div class="container">
    <input type="text" id="chat-input"></input>
    <div id="chat-messages">
        <div>assistant: Hello, I am your travel planning assistant. Where would you like to travel?</div>
        {% for message in messages %}
            <div>{{message.role}}: {{message.content}}</div>
        {% endfor %}
    </div>
  </div>
</section>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    
    let chatInput = document.getElementById('chat-input');
    let chatMessages = document.getElementById('chat-messages');
    
    chatInput.addEventListener('keydown', function(event) {
        if(event.keyCode !== 13) {
            return;
        }
        
        api
            .chat(id, chatInput.value)
            .then(function(response) {
                let userMessageDiv = document.createElement('div');
                userMessageDiv.innerText = `user: ${chatInput.value}`;
                chatMessages.appendChild(userMessageDiv);
                
                let message = response['message'];
                
                let messageDiv = document.createElement('div');
                messageDiv.innerText = `assistant: ${message}`;
                
                chatMessages.appendChild(messageDiv);
            })
            .catch(function(error) {
                alert(error);
            });
    });
</script>
<style>
    #chat-input {
        width: 100%;
    }
</style>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/api.js' %}"></script>
{% endblock %}

